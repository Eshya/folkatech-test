version: "3"

services:
  mongo-database:
    container_name: mongo-database
    image: mongo:latest
    ports:
      - 27018:27017
    volumes:
      - ./database/data/db:/data/db:rw
      - "/etc/timezone:/etc/timezone:ro"
      - "/etc/localtime:/etc/localtime:ro"
    env_file:
      - ./database/.env
    security_opt:
      - apparmor:unconfined
      - seccomp:unconfined
  
  cache:
    container_name: cache
    image: redis:6.2-alpine
    restart: always
    ports:
      - '6379:6379'
    command: redis-server --save 20 1 --loglevel warning --requirepass eYVX7EwVmmxKPCDmwMtyKVge8oLd2t81
    volumes: 
      - ./cache/data/db:/data/db:rw
    
  backend-nodejs:
    container_name: backend-nodejs
    build: ./backend
    image: eshya/folkatech-test:latest
    ports:
      - 3000:3000
    links:
      - mongo-database
    depends_on: 
      - mongo-database
    restart: always